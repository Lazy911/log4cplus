SINGLE_THREADED_TESTS = appender_test \
          customloglevel_test \
          fileappender_test \
          filter_test \
          hierarchy_test \
          loglog_test \
          ndc_test \
          ostream_test \
          patternlayout_test \
          performance_test \
          priority_test \
          propertyconfig_test \
          socket_test \
          timeformat_test

if MULTI_THREADED
SUBDIRS = $(SINGLE_THREADED_TESTS) thread_test configandwatch_test
else
SUBDIRS = $(SINGLE_THREADED_TESTS)
endif

EXTRA_DIST = testsuite.at $(TESTSUITE) atlocal.in

TESTSUITE = $(srcdir)/testsuite
AUTOTEST = $(AUTOM4TE) --language=Autotest
TESTSUITE_AT = \
  appender_test.at \
  configandwatch_test.at \
  customloglevel_test.at \
  fileappender_test.at \
  filter_test.at \
  hierarchy_test.at \
  loglog_test.at \
  ndc_test.at \
  ostream_test.at \
  patternlayout_test.at \
  priority_test.at \
  propertyconfig_test.at \
  thread_test.at \
  timeformat_test.at \
  local.at \
  testsuite.at

$(TESTSUITE): $(TESTSUITE_AT)
	$(AUTOTEST) -I $(srcdir) $(srcdir)/testsuite.at -o $@

atconfig: $(top_builddir)/config.status
	cd "$(top_builddir)" && ./config.status tests/$@

check-local: atconfig atlocal $(TESTSUITE)
	$(SHELL) $(TESTSUITE) $(TESTSUITEFLAGS)

clean-local:
	test ! -f '$(TESTSUITE)' || $(SHELL) '$(TESTSUITE)' --clean
